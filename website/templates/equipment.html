{% extends 'base.html' %}

{% block content %}
<!--
  Equipment Detail Template
  Purpose: view and edit a single equipment record.
  Expected context variables:
    - equipment: Equipment object (id, name, serial_number, location, department_id, team_id, etc.)
    - departments: list of Department objects for the department select
    - teams: list of MaintenanceTeam objects for the team select
    - work_centers: list of WorkCenter objects for optional assignment
    - active_maint: integer count of active maintenance requests for badges
  Notes:
    - Form posts to the same route and updates equipment on submit.
    - Template mixes Jinja for data binding and standard HTML for layout.
-->
<div class="fade-in max-w-6xl mx-auto"> 
    
    <!-- Header: back link, equipment title and quick access to active issues -->
    <div class="flex justify-between items-center mb-6">
        <div class="flex items-center gap-4">
            <a href="{{ url_for('equipment') }}" class="text-slate-400 hover:text-white transition flex items-center gap-2 text-sm font-medium">
                <i class="fas fa-arrow-left"></i> Back
            </a>
            <!-- Equipment name displayed as main heading -->
            <h2 class="text-2xl font-bold text-white tracking-tight">{{ equipment.name }}</h2>
        </div>
        
        <!-- Button linking to the maintenance request list filtered by this equipment.
             Badge shown only when active_maint > 0 -->
        <a href="{{ url_for('maintenance_requests', equipment_id=equipment.id) }}" 
           class="bg-slate-800 border border-slate-600 text-slate-300 px-4 py-2 rounded-lg flex items-center gap-3 hover:bg-slate-700 transition relative group shadow-sm cursor-pointer no-underline">
            
            <i class="fas fa-wrench text-violet-400 group-hover:text-violet-300"></i>
            
            <div class="text-left leading-tight">
                <span class="block text-xs font-bold text-white">Active Issues</span>
            </div>
            
            {% if active_maint > 0 %}
            <!-- Active issues badge -->
            <span class="absolute -top-2 -right-2 bg-rose-600 text-white text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full shadow-md border border-slate-900">
                {{ active_maint }}
            </span>
            {% endif %}
        </a>
    </div>

    <!-- Main panel: editable equipment form -->
    <div class="glass-panel rounded-xl p-8 border border-slate-700 shadow-2xl bg-slate-900/50">
        <!-- POSTs to the same equipment_detail route and expects standard form fields -->
        <form method="POST" action="{{ url_for('equipment_detail', id=equipment.id) }}">
            
            <!-- Two-column grid: left = identifiers & assignment, right = location & scheduling -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mb-8">
                
                <!-- Left column: name, serial, department, maintenance team -->
                <div class="space-y-5">
                    <div>
                        <!-- Equipment name: human-friendly label -->
                        <label class="block text-xs font-semibold text-slate-500 uppercase mb-1.5">Equipment Name</label>
                        <input type="text" name="name" value="{{ equipment.name }}" required
                            class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white text-sm focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-all font-medium">
                    </div>

                    <div>
                        <!-- Serial/Model: used for asset identification -->
                        <label class="block text-xs font-semibold text-slate-500 uppercase mb-1.5">Serial Number / Model</label>
                        <input type="text" name="serial_number" value="{{ equipment.serial_number }}" required
                            class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white text-sm focus:outline-none focus:border-violet-500">
                    </div>

                    <div>
                        <!-- Department select: options populated from departments context -->
                        <label class="block text-xs font-semibold text-slate-500 uppercase mb-1.5"><i class="far fa-building mr-1"></i> Department</label>
                        <div class="relative">
                            <select name="department" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white text-sm focus:outline-none focus:border-violet-500 appearance-none cursor-pointer">
                                {% for dept in departments %}
                                <option value="{{ dept.id }}" {% if equipment.department_id == dept.id %}selected{% endif %}>
                                    {{ dept.name }}
                                </option>
                                {% endfor %}
                            </select>
                            <!-- Decorative chevron; not interactive -->
                            <i class="fas fa-chevron-down absolute right-4 top-3.5 text-slate-500 text-xs pointer-events-none"></i>
                        </div>
                    </div>

                    <div>
                        <!-- Maintenance team select: choose which team owns this asset -->
                        <label class="block text-xs font-semibold text-slate-500 uppercase mb-1.5">Maintenance Team</label>
                        <div class="relative">
                            <select name="team" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white text-sm focus:outline-none focus:border-violet-500 appearance-none cursor-pointer">
                                {% for team in teams %}
                                <option value="{{ team.id }}" {% if equipment.team_id == team.id %}selected{% endif %}>
                                    {{ team.name }}
                                </option>
                                {% endfor %}
                            </select>
                            <i class="fas fa-chevron-down absolute right-4 top-3.5 text-slate-500 text-xs pointer-events-none"></i>
                        </div>
                    </div>
                </div>

                <!-- Right column: location, work center, scrap scheduling -->
                <div class="space-y-5">
                    
                    <div>
                        <!-- Location: physical placement of the equipment -->
                        <label class="block text-xs font-semibold text-slate-500 uppercase mb-1.5"><i class="fas fa-map-marker-alt mr-1"></i> Location</label>
                        <input type="text" name="location" value="{{ equipment.location }}" 
                            class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white text-sm focus:outline-none focus:border-violet-500">
                    </div>

                    <div>
                        <!-- Work center: optional mapping to production area or cell -->
                        <label class="block text-xs font-semibold text-slate-500 uppercase mb-1.5">Work Center</label>
                        <div class="relative">
                            <select name="work_center" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white text-sm focus:outline-none focus:border-violet-500 appearance-none cursor-pointer">
                                <option value="">Select Work Center (Optional)</option>
                                {% for wc in work_centers %}
                                <option value="{{ wc.id }}">
                                    {{ wc.name }} ({{ wc.code }})
                                </option>
                                {% endfor %}
                            </select>
                            <i class="fas fa-chevron-down absolute right-4 top-3.5 text-slate-500 text-xs pointer-events-none"></i>
                        </div>
                    </div>

                    <div>
                        <!-- Scrap date: schedule asset removal; optional field -->
                        <label class="block text-xs font-bold text-rose-400 uppercase mb-1.5"><i class="far fa-calendar-times mr-1"></i> Scrap Date</label>
                        <input type="date" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white text-sm focus:outline-none focus:border-rose-500 focus:ring-1 focus:ring-rose-500 transition-all placeholder-slate-500">
                        <p class="text-[10px] text-slate-500 mt-1">Set a date to schedule equipment for scrap</p>
                    </div>
                </div>
            </div>

            <!-- Tabs/navigation for detailed sections (only Description active here) -->
            <div class="mb-4 border-b border-slate-700">
                <ul class="flex flex-wrap -mb-px text-sm font-medium text-center">
                    <li class="mr-2">
                        <button type="button" class="inline-block p-4 text-violet-400 border-b-2 border-violet-500 rounded-t-lg active">Description</button>
                    </li>
                </ul>
            </div>
            
            <!-- Description: notes and free-text about the equipment -->
            <div class="bg-slate-800/30 p-4 rounded-lg border border-slate-700/50 min-h-[100px]">
                <textarea name="description" class="w-full bg-transparent border-none text-sm text-slate-300 focus:ring-0 p-0" rows="3" placeholder="Add equipment notes here...">No detailed description available.</textarea>
            </div>

            <!-- Action buttons: Cancel returns to list, Save submits form -->
            <div class="mt-8 flex justify-end gap-3 pt-6 border-t border-slate-700/50">
                <a href="{{ url_for('equipment') }}" class="px-5 py-2.5 text-sm font-medium text-slate-300 bg-slate-800 hover:bg-slate-700 rounded-lg border border-slate-700 transition">Cancel</a>
                <button type="submit" class="px-5 py-2.5 text-sm font-medium text-white bg-violet-600 hover:bg-violet-700 rounded-lg shadow-lg shadow-violet-500/20 transition transform hover:-translate-y-0.5">Save Changes</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}